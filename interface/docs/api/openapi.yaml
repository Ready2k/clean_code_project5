openapi: 3.0.3
info:
  title: Prompt Library Professional Interface API
  description: |
    RESTful API for the Prompt Library Professional Interface, providing comprehensive 
    management of LLM connections, prompt lifecycle management, and user administration.
    
    ## Authentication
    This API uses JWT Bearer tokens for authentication. Include the token in the Authorization header:
    ```
    Authorization: Bearer <your-jwt-token>
    ```
    
    ## Rate Limiting
    API requests are limited to 100 requests per 15-minute window per IP address.
    
    ## Error Handling
    All errors follow a consistent format with appropriate HTTP status codes and detailed error messages.
  version: 1.0.0
  contact:
    name: API Support
    email: support@promptlibrary.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: Development server
  - url: https://api.promptlibrary.com/api
    description: Production server

security:
  - bearerAuth: []

paths:
  # Authentication Endpoints
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user with username/email and password
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: Username or email address
                  example: user@example.com
                password:
                  type: string
                  format: password
                  description: User password
                  example: securePassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many login attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidate current session and JWT token
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      description: Get a new JWT token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: Valid refresh token
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user info
      description: Retrieve information about the currently authenticated user
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Prompt Management Endpoints
  /prompts:
    get:
      tags:
        - Prompts
      summary: List prompts
      description: Retrieve a paginated list of prompts with optional filtering
      parameters:
        - name: search
          in: query
          description: Search term for prompt title or content
          schema:
            type: string
        - name: tags
          in: query
          description: Filter by tags (comma-separated)
          schema:
            type: string
        - name: owner
          in: query
          description: Filter by owner username
          schema:
            type: string
        - name: status
          in: query
          description: Filter by prompt status
          schema:
            type: string
            enum: [draft, published, archived]
        - name: minRating
          in: query
          description: Minimum rating filter
          schema:
            type: number
            minimum: 1
            maximum: 5
        - name: maxRating
          in: query
          description: Maximum rating filter
          schema:
            type: number
            minimum: 1
            maximum: 5
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [title, created_at, updated_at, rating]
            default: updated_at
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Prompts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PromptRecord'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Prompts
      summary: Create new prompt
      description: Create a new prompt with metadata and human-readable content
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePromptRequest'
      responses:
        '201':
          description: Prompt created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptRecord'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /prompts/{id}:
    get:
      tags:
        - Prompts
      summary: Get prompt by ID
      description: Retrieve detailed information about a specific prompt
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
      responses:
        '200':
          description: Prompt retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptRecord'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Prompts
      summary: Update prompt
      description: Update an existing prompt's metadata or content
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePromptRequest'
      responses:
        '200':
          description: Prompt updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptRecord'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Prompts
      summary: Delete prompt
      description: Delete a prompt (archives it, doesn't permanently delete)
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
      responses:
        '204':
          description: Prompt deleted successfully
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /prompts/{id}/enhance:
    post:
      tags:
        - Prompts
      summary: Enhance prompt with AI
      description: Use AI to enhance and improve a prompt's structure and content
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                provider:
                  type: string
                  description: LLM provider to use for enhancement
                  example: openai
                model:
                  type: string
                  description: Specific model to use
                  example: gpt-4
                options:
                  type: object
                  description: Additional enhancement options
      responses:
        '200':
          description: Enhancement completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancementResult'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: Enhancement service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /prompts/{id}/render/{provider}:
    post:
      tags:
        - Prompts
      summary: Render prompt for provider
      description: Generate provider-specific formatted output for a prompt
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
        - name: provider
          in: path
          required: true
          description: Target provider (openai, bedrock, etc.)
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                model:
                  type: string
                  description: Target model for rendering
                  example: gpt-4
                variables:
                  type: object
                  description: Variable values for substitution
                  additionalProperties:
                    type: string
                options:
                  type: object
                  description: Rendering options (temperature, etc.)
      responses:
        '200':
          description: Prompt rendered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderPayload'
        '400':
          description: Invalid request data or missing variables
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /prompts/{id}/rate:
    post:
      tags:
        - Prompts
      summary: Rate a prompt
      description: Submit a rating and optional feedback for a prompt
      parameters:
        - name: id
          in: path
          required: true
          description: Prompt ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - score
              properties:
                score:
                  type: integer
                  minimum: 1
                  maximum: 5
                  description: Rating score (1-5 stars)
                note:
                  type: string
                  description: Optional feedback note
                  maxLength: 1000
      responses:
        '201':
          description: Rating submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rating'
        '400':
          description: Invalid rating data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Connection Management Endpoints
  /connections:
    get:
      tags:
        - Connections
      summary: List LLM connections
      description: Retrieve all configured LLM provider connections
      responses:
        '200':
          description: Connections retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LLMConnection'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Connections
      summary: Create new connection
      description: Add a new LLM provider connection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConnectionRequest'
      responses:
        '201':
          description: Connection created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LLMConnection'
        '400':
          description: Invalid connection data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /connections/{id}:
    get:
      tags:
        - Connections
      summary: Get connection by ID
      description: Retrieve details of a specific connection
      parameters:
        - name: id
          in: path
          required: true
          description: Connection ID
          schema:
            type: string
      responses:
        '200':
          description: Connection retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LLMConnection'
        '404':
          description: Connection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Connections
      summary: Update connection
      description: Update an existing LLM connection configuration
      parameters:
        - name: id
          in: path
          required: true
          description: Connection ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateConnectionRequest'
      responses:
        '200':
          description: Connection updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LLMConnection'
        '400':
          description: Invalid connection data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Connection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Connections
      summary: Delete connection
      description: Remove an LLM connection configuration
      parameters:
        - name: id
          in: path
          required: true
          description: Connection ID
          schema:
            type: string
      responses:
        '204':
          description: Connection deleted successfully
        '404':
          description: Connection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /connections/{id}/test:
    post:
      tags:
        - Connections
      summary: Test connection
      description: Test connectivity and validate credentials for an LLM connection
      parameters:
        - name: id
          in: path
          required: true
          description: Connection ID
          schema:
            type: string
      responses:
        '200':
          description: Connection test completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionTestResult'
        '404':
          description: Connection not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Template Management Endpoints
  /templates:
    get:
      tags:
        - Templates
      summary: List prompt templates
      description: Retrieve a paginated list of prompt templates with optional filtering by category
      parameters:
        - name: category
          in: query
          description: Filter by template category
          schema:
            type: string
            enum: [enhancement, question_generation, mock_responses, system_prompts, custom]
        - name: search
          in: query
          description: Search term for template name or description
          schema:
            type: string
        - name: isActive
          in: query
          description: Filter by active status
          schema:
            type: boolean
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [name, category, updated_at, usage_count]
            default: updated_at
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TemplateInfo'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Templates
      summary: Create new template
      description: Create a new prompt template with content and metadata
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateInfo'
        '400':
          description: Invalid request data or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}:
    get:
      tags:
        - Templates
      summary: Get template by ID
      description: Retrieve detailed information about a specific template
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
      responses:
        '200':
          description: Template retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateDetail'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Templates
      summary: Update template
      description: Update an existing template's content or metadata
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplateRequest'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateDetail'
        '400':
          description: Invalid request data or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Templates
      summary: Delete template
      description: Delete a template (deactivates it, doesn't permanently delete)
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
      responses:
        '204':
          description: Template deleted successfully
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}/validate:
    post:
      tags:
        - Templates
      summary: Validate template
      description: Validate template syntax, variables, and security
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
      responses:
        '200':
          description: Validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResult'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}/test:
    post:
      tags:
        - Templates
      summary: Test template
      description: Test template rendering with sample data
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateTestRequest'
      responses:
        '200':
          description: Template test completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateTestResult'
        '400':
          description: Invalid test data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}/history:
    get:
      tags:
        - Templates
      summary: Get template version history
      description: Retrieve version history for a template
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of versions per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Version history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TemplateVersion'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}/revert/{version}:
    post:
      tags:
        - Templates
      summary: Revert template to version
      description: Revert a template to a previous version
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
        - name: version
          in: path
          required: true
          description: Version number to revert to
          schema:
            type: integer
      responses:
        '200':
          description: Template reverted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateDetail'
        '400':
          description: Invalid version number
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Template or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/{id}/analytics:
    get:
      tags:
        - Templates
      summary: Get template analytics
      description: Retrieve usage statistics and performance metrics for a template
      parameters:
        - name: id
          in: path
          required: true
          description: Template ID
          schema:
            type: string
        - name: timeRange
          in: query
          description: Time range for analytics
          schema:
            type: string
            enum: [1d, 7d, 30d, 90d, 1y]
            default: 30d
      responses:
        '200':
          description: Analytics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateAnalytics'
        '404':
          description: Template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/categories:
    get:
      tags:
        - Templates
      summary: Get template categories
      description: Retrieve all available template categories with counts
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TemplateCategory'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/defaults:
    get:
      tags:
        - Templates
      summary: Get default templates
      description: Retrieve all default system templates
      responses:
        '200':
          description: Default templates retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TemplateInfo'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Templates
      summary: Reset to defaults
      description: Reset all templates to default values or restore specific defaults
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                categories:
                  type: array
                  items:
                    type: string
                    enum: [enhancement, question_generation, mock_responses, system_prompts]
                  description: Specific categories to reset (if not provided, resets all)
      responses:
        '200':
          description: Templates reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Templates reset to defaults successfully
                  resetCount:
                    type: integer
                    description: Number of templates reset
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/export:
    post:
      tags:
        - Templates
      summary: Export templates
      description: Export templates in various formats
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                templateIds:
                  type: array
                  items:
                    type: string
                  description: Specific template IDs to export (if not provided, exports all)
                format:
                  type: string
                  enum: [json, yaml]
                  default: json
                  description: Export format
                includeHistory:
                  type: boolean
                  default: false
                  description: Include version history in export
      responses:
        '200':
          description: Templates exported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateExport'
            application/x-yaml:
              schema:
                type: string
        '400':
          description: Invalid export parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /templates/import:
    post:
      tags:
        - Templates
      summary: Import templates
      description: Import templates from exported data
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateImport'
          application/x-yaml:
            schema:
              type: string
      responses:
        '200':
          description: Templates imported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Templates imported successfully
                  importedCount:
                    type: integer
                    description: Number of templates imported
                  skippedCount:
                    type: integer
                    description: Number of templates skipped due to conflicts
                  errors:
                    type: array
                    items:
                      type: string
                    description: Import errors if any
        '400':
          description: Invalid import data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # System Endpoints
  /system/status:
    get:
      tags:
        - System
      summary: Get system status
      description: Retrieve overall system health and service status
      responses:
        '200':
          description: System status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatus'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /system/stats:
    get:
      tags:
        - System
      summary: Get system statistics
      description: Retrieve system usage statistics and metrics
      responses:
        '200':
          description: System statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStats'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /system/health:
    get:
      tags:
        - System
      summary: Health check
      description: Simple health check endpoint for monitoring
      security: []
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Authentication Schemas
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: Refresh token for getting new access tokens
        user:
          $ref: '#/components/schemas/User'
        expiresIn:
          type: integer
          description: Token expiration time in seconds

    User:
      type: object
      properties:
        id:
          type: string
          description: Unique user identifier
        username:
          type: string
          description: Username
        email:
          type: string
          format: email
          description: User email address
        role:
          type: string
          enum: [admin, user, viewer]
          description: User role
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
        lastLogin:
          type: string
          format: date-time
          description: Last login timestamp
        preferences:
          $ref: '#/components/schemas/UserPreferences'

    UserPreferences:
      type: object
      properties:
        theme:
          type: string
          enum: [light, dark, auto]
          description: UI theme preference
        language:
          type: string
          description: Language preference
        defaultProvider:
          type: string
          description: Default LLM provider
        notifications:
          type: object
          description: Notification settings

    # Prompt Schemas
    PromptRecord:
      type: object
      properties:
        id:
          type: string
          description: Unique prompt identifier
        metadata:
          $ref: '#/components/schemas/PromptMetadata'
        humanPrompt:
          $ref: '#/components/schemas/HumanPrompt'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/Variable'
        ratings:
          type: object
          properties:
            average:
              type: number
              minimum: 1
              maximum: 5
            count:
              type: integer
              minimum: 0
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        owner:
          type: string
          description: Username of prompt owner

    PromptMetadata:
      type: object
      properties:
        title:
          type: string
          description: Prompt title
        summary:
          type: string
          description: Brief description of the prompt
        tags:
          type: array
          items:
            type: string
          description: Categorization tags
        status:
          type: string
          enum: [draft, published, archived]
          description: Prompt status

    HumanPrompt:
      type: object
      properties:
        goal:
          type: string
          description: What the prompt aims to achieve
        audience:
          type: string
          description: Target audience for the prompt
        steps:
          type: array
          items:
            type: string
          description: Step-by-step instructions
        outputExpectations:
          type: string
          description: Expected output format and content

    Variable:
      type: object
      properties:
        name:
          type: string
          description: Variable name
        description:
          type: string
          description: Variable description
        type:
          type: string
          enum: [string, number, boolean, array]
          description: Variable data type
        required:
          type: boolean
          description: Whether variable is required
        defaultValue:
          description: Default value for the variable

    CreatePromptRequest:
      type: object
      required:
        - metadata
        - humanPrompt
      properties:
        metadata:
          $ref: '#/components/schemas/PromptMetadata'
        humanPrompt:
          $ref: '#/components/schemas/HumanPrompt'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/Variable'

    UpdatePromptRequest:
      type: object
      properties:
        metadata:
          $ref: '#/components/schemas/PromptMetadata'
        humanPrompt:
          $ref: '#/components/schemas/HumanPrompt'
        variables:
          type: array
          items:
            $ref: '#/components/schemas/Variable'

    # Enhancement Schemas
    EnhancementResult:
      type: object
      properties:
        enhancedPrompt:
          $ref: '#/components/schemas/PromptRecord'
        rationale:
          type: string
          description: Explanation of enhancements made
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: Confidence score for enhancements
        questions:
          type: array
          items:
            type: object
            properties:
              question:
                type: string
              type:
                type: string
              required:
                type: boolean

    # Rendering Schemas
    ProviderPayload:
      type: object
      properties:
        provider:
          type: string
          description: Target provider name
        model:
          type: string
          description: Target model name
        payload:
          description: Provider-specific formatted prompt
        metadata:
          type: object
          description: Additional rendering metadata

    # Connection Schemas
    LLMConnection:
      type: object
      properties:
        id:
          type: string
          description: Unique connection identifier
        name:
          type: string
          description: Human-readable connection name
        provider:
          type: string
          enum: [openai, bedrock]
          description: LLM provider type
        status:
          type: string
          enum: [active, inactive, error]
          description: Connection status
        config:
          description: Provider-specific configuration (sensitive data masked)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        lastTested:
          type: string
          format: date-time

    CreateConnectionRequest:
      type: object
      required:
        - name
        - provider
        - config
      properties:
        name:
          type: string
          description: Human-readable connection name
        provider:
          type: string
          enum: [openai, bedrock]
          description: LLM provider type
        config:
          description: Provider-specific configuration

    UpdateConnectionRequest:
      type: object
      properties:
        name:
          type: string
          description: Human-readable connection name
        config:
          description: Provider-specific configuration

    ConnectionTestResult:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the test was successful
        latency:
          type: number
          description: Response latency in milliseconds
        error:
          type: string
          description: Error message if test failed
        availableModels:
          type: array
          items:
            type: string
          description: List of available models
        testedAt:
          type: string
          format: date-time

    # Rating Schemas
    Rating:
      type: object
      properties:
        id:
          type: string
          description: Unique rating identifier
        promptId:
          type: string
          description: ID of rated prompt
        userId:
          type: string
          description: ID of user who submitted rating
        score:
          type: integer
          minimum: 1
          maximum: 5
          description: Rating score
        note:
          type: string
          description: Optional feedback note
        createdAt:
          type: string
          format: date-time

    # System Schemas
    SystemStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, down]
          description: Overall system status
        services:
          type: object
          properties:
            api:
              $ref: '#/components/schemas/ServiceStatus'
            database:
              $ref: '#/components/schemas/ServiceStatus'
            storage:
              $ref: '#/components/schemas/ServiceStatus'
            llm:
              $ref: '#/components/schemas/ServiceStatus'
        uptime:
          type: number
          description: System uptime in seconds
        version:
          type: string
          description: Application version

    ServiceStatus:
      type: object
      properties:
        status:
          type: string
          enum: [up, down, degraded]
          description: Service status
        responseTime:
          type: number
          description: Service response time in milliseconds
        error:
          type: string
          description: Error message if service is down

    SystemStats:
      type: object
      properties:
        prompts:
          type: object
          properties:
            total:
              type: integer
            published:
              type: integer
            drafts:
              type: integer
        users:
          type: object
          properties:
            total:
              type: integer
            active:
              type: integer
        connections:
          type: object
          properties:
            total:
              type: integer
            active:
              type: integer
        storage:
          type: object
          properties:
            used:
              type: number
              description: Used storage in bytes
            available:
              type: number
              description: Available storage in bytes

    # Pagination Schema
    PaginationInfo:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
        limit:
          type: integer
          description: Items per page
        total:
          type: integer
          description: Total number of items
        totalPages:
          type: integer
          description: Total number of pages
        hasNext:
          type: boolean
          description: Whether there are more pages
        hasPrev:
          type: boolean
          description: Whether there are previous pages

    # Template Schemas
    TemplateInfo:
      type: object
      properties:
        id:
          type: string
          description: Unique template identifier
        category:
          type: string
          enum: [enhancement, question_generation, mock_responses, system_prompts, custom]
          description: Template category
        key:
          type: string
          description: Template key within category
        name:
          type: string
          description: Human-readable template name
        description:
          type: string
          description: Template description
        isActive:
          type: boolean
          description: Whether template is active
        isDefault:
          type: boolean
          description: Whether this is a default system template
        version:
          type: integer
          description: Current version number
        usageCount:
          type: integer
          description: Number of times template has been used
        lastModified:
          type: string
          format: date-time
          description: Last modification timestamp
        createdBy:
          type: string
          description: Username of template creator
        updatedBy:
          type: string
          description: Username of last modifier

    TemplateDetail:
      allOf:
        - $ref: '#/components/schemas/TemplateInfo'
        - type: object
          properties:
            content:
              type: string
              description: Template content with variable placeholders
            variables:
              type: array
              items:
                $ref: '#/components/schemas/TemplateVariable'
              description: Template variables
            metadata:
              type: object
              description: Additional template metadata
              properties:
                providerOptimized:
                  type: array
                  items:
                    type: string
                  description: LLM providers this template is optimized for
                taskTypes:
                  type: array
                  items:
                    type: string
                  description: Task types this template supports
                complexityLevel:
                  type: string
                  enum: [basic, intermediate, advanced]
                  description: Template complexity level

    TemplateVariable:
      type: object
      properties:
        name:
          type: string
          description: Variable name (without braces)
        type:
          type: string
          enum: [string, number, boolean, array, object]
          description: Variable data type
        description:
          type: string
          description: Variable description
        required:
          type: boolean
          description: Whether variable is required
        defaultValue:
          description: Default value for the variable
        validation:
          type: array
          items:
            $ref: '#/components/schemas/ValidationRule'
          description: Validation rules for the variable

    ValidationRule:
      type: object
      properties:
        type:
          type: string
          enum: [minLength, maxLength, pattern, min, max, enum]
          description: Validation rule type
        value:
          description: Validation rule value
        message:
          type: string
          description: Custom validation error message

    CreateTemplateRequest:
      type: object
      required:
        - category
        - key
        - name
        - content
      properties:
        category:
          type: string
          enum: [enhancement, question_generation, mock_responses, system_prompts, custom]
          description: Template category
        key:
          type: string
          description: Unique key within category
        name:
          type: string
          description: Human-readable template name
        description:
          type: string
          description: Template description
        content:
          type: string
          description: Template content with variable placeholders
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
          description: Template variables
        metadata:
          type: object
          description: Additional template metadata

    UpdateTemplateRequest:
      type: object
      properties:
        name:
          type: string
          description: Human-readable template name
        description:
          type: string
          description: Template description
        content:
          type: string
          description: Template content with variable placeholders
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
          description: Template variables
        metadata:
          type: object
          description: Additional template metadata
        changeMessage:
          type: string
          description: Description of changes made

    ValidationResult:
      type: object
      properties:
        isValid:
          type: boolean
          description: Whether template is valid
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ValidationError'
          description: Validation errors
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/ValidationWarning'
          description: Validation warnings

    ValidationError:
      type: object
      properties:
        type:
          type: string
          enum: [SYNTAX_ERROR, MISSING_VARIABLE, INVALID_VARIABLE, SECURITY_VIOLATION]
          description: Error type
        message:
          type: string
          description: Error message
        line:
          type: integer
          description: Line number where error occurs
        column:
          type: integer
          description: Column number where error occurs
        suggestion:
          type: string
          description: Suggested fix for the error

    ValidationWarning:
      type: object
      properties:
        type:
          type: string
          enum: [UNUSED_VARIABLE, PERFORMANCE, BEST_PRACTICE]
          description: Warning type
        message:
          type: string
          description: Warning message
        suggestion:
          type: string
          description: Suggested improvement

    TemplateTestRequest:
      type: object
      properties:
        testData:
          type: object
          description: Variable values for testing
          additionalProperties:
            description: Variable values
        provider:
          type: string
          description: Target LLM provider for testing
        options:
          type: object
          description: Additional test options

    TemplateTestResult:
      type: object
      properties:
        success:
          type: boolean
          description: Whether test was successful
        renderedContent:
          type: string
          description: Template content with variables substituted
        executionTime:
          type: number
          description: Template rendering time in milliseconds
        errors:
          type: array
          items:
            type: string
          description: Test errors if any
        warnings:
          type: array
          items:
            type: string
          description: Test warnings if any
        providerResponse:
          type: object
          description: LLM provider response if tested

    TemplateVersion:
      type: object
      properties:
        id:
          type: string
          description: Version identifier
        templateId:
          type: string
          description: Parent template ID
        versionNumber:
          type: integer
          description: Version number
        content:
          type: string
          description: Template content at this version
        variables:
          type: array
          items:
            $ref: '#/components/schemas/TemplateVariable'
          description: Template variables at this version
        metadata:
          type: object
          description: Template metadata at this version
        changeMessage:
          type: string
          description: Description of changes in this version
        createdAt:
          type: string
          format: date-time
          description: Version creation timestamp
        createdBy:
          type: string
          description: Username of version creator

    TemplateAnalytics:
      type: object
      properties:
        templateId:
          type: string
          description: Template ID
        timeRange:
          type: string
          description: Analytics time range
        usageStats:
          $ref: '#/components/schemas/UsageStats'
        performanceMetrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        trends:
          type: object
          description: Usage and performance trends

    UsageStats:
      type: object
      properties:
        totalUsage:
          type: integer
          description: Total number of times template was used
        uniqueUsers:
          type: integer
          description: Number of unique users who used the template
        averageUsagePerDay:
          type: number
          description: Average daily usage
        peakUsageDay:
          type: string
          format: date
          description: Day with highest usage
        usageByProvider:
          type: object
          description: Usage breakdown by LLM provider
          additionalProperties:
            type: integer

    PerformanceMetrics:
      type: object
      properties:
        averageRenderTime:
          type: number
          description: Average template rendering time in milliseconds
        successRate:
          type: number
          description: Success rate as percentage (0-100)
        errorRate:
          type: number
          description: Error rate as percentage (0-100)
        averageResponseTime:
          type: number
          description: Average LLM response time in milliseconds
        qualityScore:
          type: number
          description: Template quality score (0-100)

    TemplateCategory:
      type: object
      properties:
        name:
          type: string
          enum: [enhancement, question_generation, mock_responses, system_prompts, custom]
          description: Category name
        displayName:
          type: string
          description: Human-readable category name
        description:
          type: string
          description: Category description
        templateCount:
          type: integer
          description: Number of templates in this category
        activeCount:
          type: integer
          description: Number of active templates in this category

    TemplateExport:
      type: object
      properties:
        version:
          type: string
          description: Export format version
        exportedAt:
          type: string
          format: date-time
          description: Export timestamp
        templates:
          type: array
          items:
            $ref: '#/components/schemas/TemplateDetail'
          description: Exported templates
        metadata:
          type: object
          description: Export metadata

    TemplateImport:
      type: object
      properties:
        version:
          type: string
          description: Import format version
        templates:
          type: array
          items:
            $ref: '#/components/schemas/TemplateDetail'
          description: Templates to import
        options:
          type: object
          properties:
            overwriteExisting:
              type: boolean
              default: false
              description: Whether to overwrite existing templates
            preserveIds:
              type: boolean
              default: false
              description: Whether to preserve template IDs from import

    # Error Schema
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
            message:
              type: string
              description: Human-readable error message
            details:
              description: Additional error details
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
        requestId:
          type: string
          description: Unique request identifier for debugging

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Prompts
    description: Prompt library management operations
  - name: Templates
    description: LLM prompt template management and customization
  - name: Connections
    description: LLM provider connection management
  - name: System
    description: System status and administration